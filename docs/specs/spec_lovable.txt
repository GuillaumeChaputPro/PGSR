Contexte & cible Cr√©e une application web (desktop + mobile responsive) pour une cha√Æne internationale d‚Äôh√¥tels/restaurants (style Hilton) afin de contr√¥ler, piloter et reporter la conformit√© (incendie, √©lectrique, hygi√®ne, audit interne qualit√©). L‚Äôapp doit fonctionner de l‚Äô√©chelle √©tablissement jusqu‚Äôau groupe mondial (r√©gion, pays, marque, groupe).

R√¥les & permissions (RBAC hi√©rarchique) ‚Ä¢ OrgOwner (groupe) : acc√®s global √† toutes les donn√©es et param√®tres, lecture/√©criture/gestion. ‚Ä¢ BrandManager (marque) : lecture/√©criture sur les entit√©s de sa marque. ‚Ä¢ RegionManager (r√©gion/pays) : lecture/√©criture sur les entit√©s de son p√©rim√®tre (r√©gion OU pays). ‚Ä¢ SiteManager (√©tablissement) : lecture/√©criture sur son √©tablissement uniquement. ‚Ä¢ Auditor (interne/externe) : peut ex√©cuter des audits, charger des preuves, cr√©er des observations/correctifs sur les sites assign√©s, lecture restreinte hors site. ‚Ä¢ Viewer : lecture seule selon p√©rim√®tre (brand/region/site).

Mod√®le de donn√©es (collections / tables, avec champs & contraintes)

Impl√©mente en base relationnelle avec r√©f√©rences fortes, cl√©s techniques UUID, timestamps, et champs created_by, updated_by. Ajoute index utiles (ex. sur scope et status).

1.	OrgUnit (unit√© organisationnelle)

‚Ä¢	id: uuid
‚Ä¢	type: enum["GROUP","BRAND","REGION","COUNTRY","SITE"]
‚Ä¢	name: string (unique per parent)
‚Ä¢	parent_id: uuid? (FK ‚Üí OrgUnit)
‚Ä¢	country_code: string? (ISO-2, pour COUNTRY/SITE)
‚Ä¢	brand_code: string? (pour BRAND/SITE)
‚Ä¢	address: string?, city: string?, lat: number?, lng: number?
‚Ä¢	active: boolean default true

2.	User

‚Ä¢	id: uuid, email: string unique, full_name: string
‚Ä¢	role: enum["OrgOwner","BrandManager","RegionManager","SiteManager","Auditor","Viewer"]
‚Ä¢	scopes: array<uuid> (liste d‚ÄôOrgUnit autoris√©es ; si vide et r√¥le = OrgOwner ‚áí global)
‚Ä¢	locale: enum["en","fr"] default "en"
‚Ä¢	avatar_url: string?, active: boolean default true

3.	ComplianceFramework (r√©f√©rentiel : ex. ‚ÄúIncendie ‚Äì H√¥tels Europe 2025‚Äù)

‚Ä¢	id: uuid, code: string unique, title: string, description: text?
‚Ä¢	domain: enum["FIRE","ELECTRICAL","HYGIENE","QUALITY","OTHER"]
‚Ä¢	version: string (ex. ‚Äúv1.0‚Äù)
‚Ä¢	valid_from: date, valid_to: date?
‚Ä¢	applies_to_levels: array<enum["SITE","COUNTRY","REGION","BRAND","GROUP"]>

4.	ChecklistTemplate (mod√®le d‚Äôaudit instanciable)

‚Ä¢	id: uuid, framework_id: uuid (FK)
‚Ä¢	title: string, description: text?
‚Ä¢	scoring_method: enum["SUM","WEIGHTED","PASS_FAIL"]
‚Ä¢	weight_total: number default 100
‚Ä¢	applicability_rules: jsonb (ex. pays/brand/typo site)

5.	ChecklistItemTemplate

‚Ä¢	id: uuid, checklist_template_id: uuid (FK)
‚Ä¢	ref: string (ex. ‚ÄúFIRE-1.2‚Äù)
‚Ä¢	label: string, help_text: text?
‚Ä¢	response_type: enum["BOOLEAN","SINGLE_CHOICE","MULTI_CHOICE","NUMBER","TEXT","PHOTO","SIGNATURE"]
‚Ä¢	choices: jsonb? (si choix)
‚Ä¢	weight: number default 1
‚Ä¢	critical: boolean default false (KO critique ‚áí audit KO)
‚Ä¢	evidence_required: boolean default false
‚Ä¢	legal_reference: string? (norme/codification)

6.	Audit

‚Ä¢	id: uuid, orgunit_id: uuid (FK‚ÜíSITE requis), framework_id: uuid, template_id: uuid
‚Ä¢	status: enum["DRAFT","IN_PROGRESS","SUBMITTED","APPROVED","REJECTED","NON_COMPLIANT","COMPLIANT"] default "DRAFT"
‚Ä¢	scheduled_at: datetime?, started_at: datetime?, submitted_at: datetime?, approved_at: datetime?
‚Ä¢	auditor_id: uuid (FK‚ÜíUser), owner_id: uuid (FK‚ÜíUser)
‚Ä¢	score_raw: number?, score_percent: number?, critical_fail: boolean default false
‚Ä¢	overall_comment: text?

7.	AuditItem

‚Ä¢	id: uuid, audit_id: uuid (FK), item_template_id: uuid (FK)
‚Ä¢	response_value: jsonb? (selon type)
‚Ä¢	pass: boolean?
‚Ä¢	evidence_count: number default 0
‚Ä¢	comment: text?
‚Ä¢	nonconformity_level: enum["NONE","MINOR","MAJOR","CRITICAL"] default "NONE"

8.	Evidence (GED / coffre-fort)

‚Ä¢	id: uuid, audit_item_id: uuid (FK)?, audit_id: uuid (FK)?
‚Ä¢	file_url: string, file_name: string, mime: string, size_bytes: number
‚Ä¢	hash_sha256: string
‚Ä¢	uploaded_by: uuid (FK‚ÜíUser), uploaded_at: datetime
‚Ä¢	doc_type: enum["PHOTO","PDF","CERTIFICATE","REPORT","OTHER"]
‚Ä¢	valid_until: date? (pour certificats)
‚Ä¢	Stockage : utilise le storage Lovable (ou S3 si dispo), activer versioning si possible.

9.	ActionPlan (plan d‚Äôactions correctives)

‚Ä¢	id: uuid, audit_id: uuid (FK), title: string
‚Ä¢	status: enum["OPEN","IN_PROGRESS","DONE","CANCELLED"] default "OPEN"
‚Ä¢	due_date: date?, owner_id: uuid (FK‚ÜíUser)

10.	ActionItem

‚Ä¢	id: uuid, action_plan_id: uuid (FK), label: string, status: enum["OPEN","IN_PROGRESS","DONE","CANCELLED"], due_date: date?, assignee_id: uuid?

11.	CertificateRegister (registre l√©gal des certificats par site)

‚Ä¢	id: uuid, orgunit_id: uuid (SITE), name: string, doc_id: uuid (FK‚ÜíEvidence)
‚Ä¢	domain: enum["FIRE","ELECTRICAL","HYGIENE","QUALITY","OTHER"]
‚Ä¢	issued_on: date, valid_until: date, issuer: string, status: enum["VALID","EXPIRING_SOON","EXPIRED"] (champ calcul√©)
R√®gles de permissions (appliquer dans toutes les pages & API internes) ‚Ä¢ Un utilisateur ne voit et ne modifie que les enregistrements rattach√©s √† ses scopes (OrgUnit) et √† son r√¥le. ‚Ä¢ OrgOwner : full access. ‚Ä¢ BrandManager : acc√®s aux OrgUnit BRAND + descendants. ‚Ä¢ RegionManager : acc√®s √† REGION/COUNTRY + descendants. ‚Ä¢ SiteManager : acc√®s √† SITE uniquement. ‚Ä¢ Auditor : cr√©ation/√©dition d‚ÄôAudit/AuditItem/Evidence sur sites assign√©s, lecture du reste dans le p√©rim√®tre. ‚Ä¢ Viewer : lecture seule dans le p√©rim√®tre.

√âcrans / UX (pages & composants) 1. Login (SSO ult√©rieur, pour MVP email+password). 2. Dashboard (contextuel au r√¥le) ‚Ä¢ KPI : % conformit√© (30/90 jours), # audits ouverts, # actions en retard, certificats expirant (<30j). ‚Ä¢ Filtres : p√©riode, domaine (incendie/√©lectrique/‚Ä¶), marque, pays, site. ‚Ä¢ Graphs : heatmap conformit√© par pays, barre par marque, tendance temporelle. 3. Org Explorer (vue hi√©rarchique) ‚Ä¢ Arbre Group ‚Üí Brand ‚Üí Region ‚Üí Country ‚Üí Site, avec stats badges (% conformit√©, audits ouverts). 4. Audits ‚Ä¢ Liste + filtres (status, domaine, site, date). ‚Ä¢ D√©tail audit : header (site, statut, score), onglets Checklist, Preuves, Plan d‚Äôactions, Historique. ‚Ä¢ Ex√©cution checklist (mobile-first) : items avec r√©ponses (boolean/choix/nombre/texte/photo/signature), upload multi-preuves, marquer ‚Äúcritique‚Äù, commentaires. ‚Ä¢ Boutons : Enregistrer, Soumettre, Approuver/Rejeter (selon r√¥le). 5. R√©f√©rentiels ‚Ä¢ ComplianceFramework (CRUD + version), ChecklistTemplate (CRUD), ChecklistItemTemplate (CRUD) avec duplication et export/import JSON. 6. GED / Registre ‚Ä¢ Biblioth√®que de documents (Evidence) avec filtres (site, type, domaine, expiration). ‚Ä¢ CertificateRegister : tableau avec statut calcul√© (VALID/EXPIRING/EXPIRED), alertes. 7. Administration ‚Ä¢ Utilisateurs, r√¥les, scopes (assignation par s√©lection d‚ÄôOrgUnit), localisation (i18n en/fr), param√®tres d‚Äôalertes.

Workflows & automatisations ‚Ä¢ Audit.status machine : ‚Ä¢ DRAFT ‚Üí IN_PROGRESS ‚Üí SUBMITTED ‚Üí (APPROVED | REJECTED) ‚Ä¢ Si critical d√©tect√© sur un item ‚áí NON_COMPLIANT. Si score ‚â• seuil (ex. 85%) et aucun critique ‚áí COMPLIANT. ‚Ä¢ Scoring : recalcul √† chaque modification d‚ÄôAuditItem: ‚Ä¢ SUM/WEIGHTED: somme pond√©r√©e / total * 100, PASS_FAIL: 0/100 si KO critique. ‚Ä¢ Rappels certificats : t√¢ches quotidiennes ‚Üí marquer EXPIRING_SOON √† J-30, envoyer notifs aux SiteManager + RegionManager. ‚Ä¢ Action plans : auto-cr√©ation d‚Äôun ActionPlan si NON_COMPLIANT ou item critique KO ; copier les ActionItem propos√©s depuis un mapping de non-conformit√©s (si dispo). ‚Ä¢ GED hashing : stocker hash_sha256 √† l‚Äôupload ; afficher dans la fiche document. ‚Ä¢ Journal d‚Äôaudit (audit trail) : log sur changements de statut, suppression document, approbation.

R√®gles de validation & s√©curit√© ‚Ä¢ Upload : taille max 25 MB (ajuster si Lovable le permet), extensions autoris√©es : pdf, jpg, png, heic. ‚Ä¢ Evidence sur item critique ‚áí evidence_required = true impose au moins 1 fichier. ‚Ä¢ Un Audit ne peut √™tre SUBMITTED que si 100% des items r√©pondus. ‚Ä¢ CertificateRegister.valid_until < today ‚áí statut EXPIRED. ‚Ä¢ Minimise l‚Äôexposition de donn√©es hors p√©rim√®tre (toujours filtrer par scopes). ‚Ä¢ Masquer les menus non autoris√©s selon r√¥le.

BI / Rapports (MVP interne Lovable) ‚Ä¢ Dashboard : ‚Ä¢ Carte/heatmap par pays avec % conformit√© moyen (agr√©gation par Audit APPROVED sur p√©riode). ‚Ä¢ Bar chart par marque et domaine. ‚Ä¢ Liste des Top 10 sites √† risque (score bas, critiques pr√©sents). ‚Ä¢ Export CSV/PDF pour : liste audits, registre certificats, plan d‚Äôactions.

Internationalisation (fr/en) ‚Ä¢ UI key/value fr/en (au moins pour labels principaux : menus, statuts, domaines, boutons). ‚Ä¢ Format date/heure selon locale utilisateur.

Donn√©es d‚Äôexemple (seed) ‚Ä¢ OrgUnits : 1 Group (‚ÄúHilton Group‚Äù), 2 Brands (‚ÄúHilton‚Äù, ‚ÄúHilton Garden‚Äù), 2 Regions (EU, AMER), 3 Countries (FR, IT, US), 5 Sites (Paris-Op√©ra, Rome-Centro, Milan-Duomo, NYC-Midtown, Miami-Beach). ‚Ä¢ Users : 1 OrgOwner global, 1 BrandManager (Hilton), 1 RegionManager (EU), 2 SiteManagers (Paris, Rome), 2 Auditors. ‚Ä¢ Frameworks : FIRE v1.0, ELECTRICAL v1.0. ‚Ä¢ Templates : ‚ÄúFire Safety ‚Äì Hotel (EU) v1.0‚Äù avec 10 items (2 critiques) ; ‚ÄúElectrical ‚Äì Hotel (EU) v1.0‚Äù avec 8 items. ‚Ä¢ Audits : 3 en cours, 2 approuv√©s, 1 non conforme avec actions ouvertes. ‚Ä¢ Evidences : 5 photos, 2 certificats PDF (dont 1 expirant √† J-20).

Qualit√© & non-r√©gression (inclure checks automatiques si possible) ‚Ä¢ Tests navigation par r√¥le : chaque r√¥le ne voit que son p√©rim√®tre. ‚Ä¢ Test soumission audit avec item critique sans preuve ‚áí blocage. ‚Ä¢ Test recalcul score et changement auto de statut (COMPLIANT/NON_COMPLIANT). ‚Ä¢ Test rappels certificats (statuts, notifications). ‚Ä¢ Test export CSV/PDF (au moins 1 export par module).

Livrables attendus par l‚ÄôIA ‚Ä¢ Base de donn√©es cr√©√©e avec toutes les collections, relations, indexes et contraintes ci-dessus. ‚Ä¢ √âcrans list√©s (Dashboard, Org Explorer, Audits, R√©f√©rentiels, GED/Registre, Admin). ‚Ä¢ Workflows et validations op√©rationnels. ‚Ä¢ Donn√©es d‚Äôexemple inject√©es. ‚Ä¢ I18n fr/en basique sur les libell√©s principaux. ‚Ä¢ Un guide d‚Äôutilisation (page ‚ÄúHelp‚Äù) r√©sumant les √©tapes : cr√©er un audit, l‚Äôex√©cuter, soumettre, approuver, charger certificats, consulter registres et dashboards.

Important : si une limite Lovable emp√™che une partie (ex. i18n, heatmap, hash), impl√©mente un fallback (ex. tableau + badge pays, champ texte ‚Äúhash‚Äù) et documente la limite dans la page Help.

‚∏ª

üîÅ PROMPTS ADD-ONS (√† utiliser apr√®s la g√©n√©ration)

Ajout mode offline (si Lovable le supporte partiellement)
‚ÄúAjoute un cache local pour la page d‚Äôex√©cution de checklist : mise en file des r√©ponses, des photos et des commentaires avec synchro d√®s retour r√©seau. Affiche un badge OFFLINE et un compteur d‚Äô√©l√©ments en attente.‚Äù

Power BI/Metabase (pr√©-int√©gration)
‚ÄúExpose un endpoint JSON en lecture seule avec agr√©gats par niveau (site/pays/marque) : score moyen, nb audits, nb critiques, sur une p√©riode. Documente le sch√©ma et ajoute une page ‚ÄòAPI‚Äô.‚Äù

SSO / SCIM (placeholder)
‚ÄúPr√©pare une page ‚ÄòIdentity & SSO (placeholder)‚Äô avec champs de config (issuer, client_id, metadata URL) et note sur future int√©gration Azure AD/Okta. Ajoute un toggle ‚ÄòSCIM planned‚Äô.‚Äù

Th√©ming & branding
‚ÄúApplique un th√®me entreprise sombre/clair, couleurs primaires #0B5FFF et secondaire #00D2C4, logo fictif ‚ÄòCompliance One‚Äô. Page de login et favicon.‚Äù

S√©curit√© & audit trail
‚ÄúAjoute une collection AuditLog (who/what/when/before/after), logge chaque changement sensible (status audit, suppression evidence, modification r√©f√©rentiel). Ajoute un √©cran lecture-only pour OrgOwner.‚Äù

‚∏ª

‚úÖ Crit√®res d‚Äôacceptation (checklist rapide) ‚Ä¢ R√¥les/permissions effectives et test√©es par p√©rim√®tre. ‚Ä¢ Cr√©ation ‚Üí ex√©cution ‚Üí soumission ‚Üí approbation d‚Äôun audit 100% fonctionnelle. ‚Ä¢ Scoring calcul√© + bascule auto COMPLIANT/NON_COMPLIANT (critique). ‚Ä¢ GED op√©rationnelle (upload, aper√ßu miniature, filtres, version simple). ‚Ä¢ Registre certificats avec statuts dynamiques et rappels J-30. ‚Ä¢ Dashboards avec filtres multi-niveaux et exports. ‚Ä¢ Donn√©es seed conformes (brands, pays, sites, users). ‚Ä¢ Page Help et page Admin compl√®tes.
